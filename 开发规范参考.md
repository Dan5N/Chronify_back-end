# Chronify项目开发规范参考

基于Tlias项目的最佳实践，制定Chronify后端项目的开发规范。

## 1. 技术栈

### 1.1 核心框架
- **Spring Boot**: 3.4.8
- **Java**: 17 (LTS版本)
- **Maven**: 依赖管理和构建工具

### 1.2 数据层技术
- **MyBatis**: 3.0.4 (ORM框架)
- **MySQL**: 8.0+ (数据库)
- **PageHelper**: 1.4.7 (分页插件)

### 1.3 开发工具库
- **Lombok**: 1.18.30 (代码简化)
- **JWT**: 0.9.1 (Token认证)
- **Validation**: Jakarta Validation (参数校验)

## 2. 项目结构

```
src/main/java/org/example/
├── config/          # 配置类
├── controller/      # 控制器层
├── exception/       # 异常处理
├── filter/          # 过滤器
├── interceptor/     # 拦截器
├── mapper/          # MyBatis映射器
├── pojo/           # 数据对象
├── service/        # 服务层接口
├── service/impl/   # 服务层实现
└── util/           # 工具类
```

## 3. 编码规范

### 3.1 命名规范
- **类名**: 大驼峰命名 (PascalCase)
- **方法名/变量名**: 小驼峰命名 (camelCase)
- **常量**: 全大写下划线分隔 (UPPER_SNAKE_CASE)
- **包名**: 全小写点分隔

### 3.2 注解使用
```java
// 日志注解
@Slf4j
@RestController
@RequestMapping("/schedules")
public class ScheduleController {

    // 依赖注入
    @Autowired
    private ScheduleService scheduleService;

    // 请求映射
    @GetMapping
    public Result page(ScheduleQueryParam queryParam) {
        // 实现逻辑
    }

    @PostMapping
    public Result save(@RequestBody @Valid Schedule schedule) {
        // 实现逻辑
    }
}
```

### 3.3 数据对象设计
```java
@Data // Lombok自动生成getter/setter
public class Schedule {
    private Long id;
    private String event;
    private LocalDate date;
    private LocalTime time;
    private String location;
    private String people;
    private String priority;
    private Long userId;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
}
```

## 4. 统一响应格式

### 4.1 Result类设计
```java
@Data
public class Result {
    private Integer code;  // 1成功, 0失败
    private String msg;    // 提示信息
    private Object data;   // 返回数据

    public static Result success() {
        Result result = new Result();
        result.code = 1;
        result.msg = "success";
        return result;
    }

    public static Result success(Object data) {
        Result result = new Result();
        result.code = 1;
        result.msg = "success";
        result.data = data;
        return result;
    }

    public static Result error(String msg) {
        Result result = new Result();
        result.code = 0;
        result.msg = msg;
        return result;
    }
}
```

### 4.2 分页结果封装
```java
@Data
public class PageResult {
    private Long total;    // 总记录数
    private List rows;     // 当前页数据列表
}
```

## 5. 数据库设计规范

### 5.1 表设计原则
- 表名使用小写+下划线
- 字段名使用小写+下划线
- 主键统一使用 `id BIGINT AUTO_INCREMENT`
- 必须包含 `create_time`, `update_time`, `deleted_at`
- 软删除使用 `deleted_at` 字段

### 5.2 MyBatis配置
```yaml
mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    map-underscore-to-camel-case: true  # 下划线转驼峰

pagehelper:
  reasonable: true
  helper-dialect: mysql
```

## 6. 异常处理

### 6.1 全局异常处理器
```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        log.error("系统异常", e);
        return Result.error("系统异常，请联系管理员");
    }

    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        log.warn("业务异常: {}", e.getMessage());
        return Result.error(e.getMessage());
    }
}
```

## 7. 日志规范

### 7.1 日志级别
- **ERROR**: 系统错误，需要立即处理
- **WARN**: 业务异常，需要关注
- **INFO**: 重要业务流程
- **DEBUG**: 调试信息

### 7.2 日志格式
```java
@Slf4j
public class ScheduleService {
    public Result createSchedule(Schedule schedule) {
        log.info("创建日程请求参数: {}", schedule);
        try {
            // 业务逻辑
            log.info("日程创建成功，ID: {}", schedule.getId());
            return Result.success();
        } catch (Exception e) {
            log.error("创建日程失败", e);
            return Result.error("创建日程失败");
        }
    }
}
```

## 8. 安全规范

### 8.1 JWT认证
- 使用JWT进行用户认证
- Token放在请求头 `Authorization: Bearer {token}`
- 实现Token过滤器验证

### 8.2 参数校验
```java
@Data
public class Schedule {
    @NotBlank(message = "事件名称不能为空")
    private String event;

    @NotNull(message = "日期不能为空")
    @Future(message = "日期必须是未来时间")
    private LocalDate date;

    @NotBlank(message = "优先级不能为空")
    private String priority;
}
```

## 9. API设计规范

### 9.1 RESTful API
- GET: 查询资源
- POST: 创建资源
- PUT: 更新资源
- DELETE: 删除资源

### 9.2 URL设计
```
GET    /api/v1/schedules          # 获取日程列表
POST   /api/v1/schedules          # 创建日程
GET    /api/v1/schedules/{id}     # 获取单个日程
PUT    /api/v1/schedules/{id}     # 更新日程
DELETE /api/v1/schedules/{id}     # 删除日程
```

## 10. 测试规范

### 10.1 单元测试
- Service层方法必须编写单元测试
- 使用Spring Boot Test框架
- 测试覆盖率不低于80%

### 10.2 集成测试
- Controller层编写集成测试
- 使用MockMvc模拟HTTP请求

## 11. 代码质量

### 11.1 代码审查
- 每个PR必须经过代码审查
- 关注代码可读性、性能、安全性
- 遵循阿里巴巴Java开发规范

### 11.2 代码格式化
- 使用IDE统一代码格式化配置
- 代码缩进使用4个空格
- 行长度不超过120字符

## 12. Git规范

### 12.1 分支管理
- main: 主分支，生产环境代码
- develop: 开发分支
- feature/*: 功能分支
- hotfix/*: 热修复分支

### 12.2 提交信息
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动
```

---

**注意**: 本规范基于Tlias项目的最佳实践制定，适用于Chronify后端项目的开发工作。所有开发人员必须严格遵循本规范，确保代码质量和项目的可维护性。